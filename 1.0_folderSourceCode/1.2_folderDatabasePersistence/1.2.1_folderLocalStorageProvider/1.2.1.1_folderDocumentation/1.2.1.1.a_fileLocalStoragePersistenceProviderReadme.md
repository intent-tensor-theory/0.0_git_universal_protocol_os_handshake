# LocalStorage Persistence Provider

**Address:** `1.2.1`  
**Type:** Browser LocalStorage  
**Setup Required:** None

---

## Overview

The LocalStorage provider is the **default** database provider for Protocol OS. It requires no configuration and works immediately in any browser environment.

## Features

| Feature | Supported |
|---------|-----------|
| Zero Configuration | ✅ |
| Offline Support | ✅ |
| Cross-Tab Sync | ❌ |
| Transactions | ❌ |
| Cloud Sync | ❌ |
| Data Export | ✅ |
| Data Import | ✅ |

## Storage Limits

- **Maximum Size:** ~5MB per domain (browser dependent)
- **Maximum Logs:** 1000 execution logs (auto-pruned)
- **Persistence:** Until browser storage cleared

## When to Use

✅ **Recommended for:**
- Development and prototyping
- Single-user local installations
- Demo and testing scenarios
- Quick starts without backend setup

❌ **Not recommended for:**
- Production multi-user deployments
- Data that must persist across devices
- Collaboration features
- Large data volumes (>5MB)

## Configuration

No configuration required. The provider uses sensible defaults:

```typescript
// In 1.2.c_fileActiveDatabaseProviderToggle.ts
const ACTIVE_PROVIDER: DatabaseProviderType = 'localStorage';
```

### Optional Environment Variables

```env
# Prefix for localStorage keys (default: protocol-os)
VITE_LOCALSTORAGE_PREFIX=my-app

# Enable debug logging
VITE_DB_DEBUG=true
```

## Data Structure

Data is stored in localStorage with the following key pattern:

```
{prefix}:{collection}
```

Collections:
- `protocol-os:platforms`
- `protocol-os:resources`
- `protocol-os:handshakes`
- `protocol-os:curlRequests`
- `protocol-os:schemaModels`
- `protocol-os:promotedActions`
- `protocol-os:executionLogs`

Each collection stores a JSON array of entities.

## Export/Import

### Export All Data

```typescript
import { getActiveProvider } from '@database';

const db = getActiveProvider();
const { data } = await db.exportAllData();

// Save to file
const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
const url = URL.createObjectURL(blob);
// ... trigger download
```

### Import Data

```typescript
import { getActiveProvider } from '@database';

const db = getActiveProvider();
const importedData = JSON.parse(fileContents);
await db.importData(importedData);
```

## Migrating to Another Provider

When ready to scale, you can export your localStorage data and import it into a cloud provider:

1. Export your data:
   ```typescript
   const { data } = await db.exportAllData();
   ```

2. Change provider in toggle:
   ```typescript
   const ACTIVE_PROVIDER = 'supabase'; // or firebase, postgresql, sqlite
   ```

3. Configure the new provider's environment variables

4. Import your data:
   ```typescript
   await db.importData(data);
   ```

## Debugging

Enable debug mode to see all operations logged:

```env
VITE_DB_DEBUG=true
```

Console output:
```
[LocalStorage] Initialized with prefix: protocol-os
[LocalStorage] Created platform: plat_abc123
[LocalStorage] Updated handshake: hs_def456
```

## Browser DevTools

You can inspect and modify data directly:

1. Open DevTools → Application → Local Storage
2. Find keys starting with `protocol-os:`
3. View/edit JSON data

**⚠️ Warning:** Manual edits may break data integrity. Export before modifying.

## Limitations

1. **5MB Limit:** Large datasets will fail silently or throw quota errors
2. **No Sync:** Changes don't sync across tabs or browsers
3. **Volatile:** Users can clear storage at any time
4. **No Encryption:** Data is stored as plain text
5. **No Transactions:** Partial failures may leave inconsistent state

## Troubleshooting

### "QuotaExceededError"

Storage limit reached. Solutions:
- Clear old execution logs: `db.clearOldExecutionLogs(new Date(Date.now() - 7 * 24 * 60 * 60 * 1000))`
- Export and migrate to a cloud provider
- Clear all data and reimport essential items

### Data Not Persisting

Check if:
- Browser is in private/incognito mode
- Storage permissions are blocked
- Another script is clearing localStorage

### Performance Issues

LocalStorage is synchronous and can block the main thread with large datasets. Consider:
- Reducing stored data
- Migrating to IndexedDB (future provider)
- Using a cloud provider

---

## Next Steps

When you outgrow localStorage:

| Need | Recommended Provider |
|------|---------------------|
| Multi-user collaboration | Supabase or Firebase |
| Server-side deployment | PostgreSQL |
| Offline-first mobile | SQLite |
| Real-time sync | Firebase |
