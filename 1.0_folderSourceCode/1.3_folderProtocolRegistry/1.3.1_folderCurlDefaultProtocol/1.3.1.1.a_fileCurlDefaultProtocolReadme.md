# cURL Default Protocol

> **Address:** 1.3.1  
> **Type:** Protocol Module  
> **Status:** Stable  
> **Version:** 1.0.0

The foundational protocol adapter for Protocol OS. Execute any HTTP API using familiar cURL command syntax.

---

## Overview

The cURL Default Protocol is the **universal adapter** - it accepts any cURL command as a template and handles execution, error handling, retries, and dynamic value injection automatically.

### Why cURL?

- **Zero Learning Curve**: Every developer knows cURL syntax
- **Copy-Paste Ready**: API documentation includes cURL examples
- **Universal**: Any REST, GraphQL, or HTTP API works
- **Familiar**: No new DSL or configuration format to learn

---

## Quick Start

### 1. Paste Your cURL Command

```bash
curl -X POST 'https://api.example.com/v1/users' \
  -H 'Authorization: Bearer {{access_token}}' \
  -H 'Content-Type: application/json' \
  -d '{"name": "{{user_name}}", "email": "{{email}}"}'
```

### 2. Provide Placeholder Values

```json
{
  "access_token": "your-token-here",
  "user_name": "John Doe",
  "email": "john@example.com"
}
```

### 3. Execute

Protocol OS parses the command, substitutes the placeholders, executes the request, and returns the result.

---

## Placeholder System

Use `{{placeholder_name}}` syntax for dynamic values.

### Basic Placeholders

```bash
curl 'https://api.example.com/users/{{user_id}}'
```

Values:
```json
{ "user_id": "12345" }
```

Result:
```
GET https://api.example.com/users/12345
```

### Multiple Placeholders

```bash
curl -X POST 'https://{{host}}/api/v{{version}}/data' \
  -H 'X-API-Key: {{api_key}}' \
  -d '{"id": "{{item_id}}"}'
```

Values:
```json
{
  "host": "api.example.com",
  "version": "2",
  "api_key": "key_xxx",
  "item_id": "abc123"
}
```

### Special Placeholders

Built-in dynamic values (prefix with `$`):

| Placeholder | Description | Example Output |
|-------------|-------------|----------------|
| `{{$timestamp}}` | Unix timestamp | `1701619200` |
| `{{$uuid}}` | UUID v4 | `550e8400-e29b-41d4-a716-446655440000` |
| `{{$random}}` | Random string | `a7b3c9d2e1f0` |
| `{{$date}}` | ISO date | `2024-12-03` |
| `{{$datetime}}` | ISO datetime | `2024-12-03T10:30:00Z` |

---

## Supported cURL Options

| Flag | Long Form | Description |
|------|-----------|-------------|
| `-X` | `--request` | HTTP method (GET, POST, PUT, etc.) |
| `-H` | `--header` | Add request header |
| `-d` | `--data` | Request body |
| | `--data-raw` | Raw request body |
| | `--data-binary` | Binary request body |
| `-u` | `--user` | Basic auth (user:pass) |
| `-A` | `--user-agent` | Set User-Agent |
| `-k` | `--insecure` | Skip SSL verification |
| `-L` | `--location` | Follow redirects |
| `-m` | `--max-time` | Timeout in seconds |
| | `--connect-timeout` | Connection timeout |

---

## Configuration Options

### Timeouts

```typescript
{
  timeout: 30000,        // Request timeout (ms)
  followRedirects: true, // Follow HTTP redirects
  maxRedirects: 5        // Maximum redirects
}
```

### Retry Behavior

```typescript
{
  retryOnFailure: true,  // Enable auto-retry
  maxRetries: 3,         // Maximum attempts
  retryDelay: 1000       // Base delay between retries (ms)
}
```

Retry triggers:
- Network errors
- Timeouts
- 5xx server errors

No retry for:
- 4xx client errors (bad request, unauthorized, etc.)

### SSL/TLS

```typescript
{
  validateSsl: true,     // Validate certificates (recommended)
  caCertificate: '...',  // Custom CA cert (optional)
}
```

### Proxy

```typescript
{
  proxyUrl: 'http://proxy.example.com:8080'
}
```

---

## Examples

### Example 1: Simple GET Request

```bash
curl 'https://api.github.com/users/{{username}}'
```

```json
{ "username": "octocat" }
```

### Example 2: POST with JSON

```bash
curl -X POST 'https://api.stripe.com/v1/charges' \
  -u '{{secret_key}}:' \
  -d 'amount={{amount}}' \
  -d 'currency={{currency}}' \
  -d 'source={{token}}'
```

```json
{
  "secret_key": "sk_test_xxx",
  "amount": "2000",
  "currency": "usd",
  "token": "tok_visa"
}
```

### Example 3: GraphQL Query

```bash
curl -X POST 'https://api.example.com/graphql' \
  -H 'Authorization: Bearer {{token}}' \
  -H 'Content-Type: application/json' \
  -d '{
    "query": "query { user(id: \"{{user_id}}\") { name email } }"
  }'
```

### Example 4: File Upload (Base64)

```bash
curl -X POST 'https://api.example.com/upload' \
  -H 'Authorization: Bearer {{token}}' \
  -H 'Content-Type: application/json' \
  -d '{
    "filename": "{{filename}}",
    "content": "{{base64_content}}"
  }'
```

### Example 5: Multi-Part Form

```bash
curl -X POST 'https://api.example.com/form' \
  -H 'Authorization: Bearer {{token}}' \
  -F 'name={{name}}' \
  -F 'file=@{{filepath}}'
```

---

## Error Handling

### Error Codes

| Code | Description | Typical Cause |
|------|-------------|---------------|
| `NO_COMMAND` | No cURL command | Configuration missing |
| `PARSE_ERROR` | Invalid cURL syntax | Malformed command |
| `NETWORK_ERROR` | Network failure | No internet, DNS issues |
| `TIMEOUT` | Request timeout | Slow server, network |
| `SSL_ERROR` | Certificate error | Invalid/expired cert |
| `CLIENT_ERROR` | 4xx response | Bad request, auth failure |
| `SERVER_ERROR` | 5xx response | Server-side issue |

### Result Structure

```typescript
interface Result {
  success: boolean;        // true if 2xx status
  statusCode: number;      // HTTP status code
  headers: Record<string, string>;
  body: any;               // Parsed JSON or string
  rawBody: string;         // Raw response
  durationMs: number;      // Execution time
  error?: string;          // Error message
  errorCode?: string;      // Error classification
  retry?: {
    attempted: boolean;
    count: number;
    reason?: string;
  };
}
```

---

## Security

### Credential Masking

Sensitive values are automatically masked in logs and UI:

```
Authorization: Bearer eyJh...****...Xk2M
X-API-Key: sk_****_xxxx
```

### SSL Validation

SSL certificate validation is **enabled by default**. Only disable for development with self-signed certificates:

```typescript
{ validateSsl: false }  // ⚠️ Not recommended for production
```

### Blocked Protocols

The following URL protocols are blocked for security:
- `file://`
- `ftp://`
- `gopher://`

Only `http://` and `https://` are allowed.

---

## Best Practices

### DO ✅

- Use descriptive placeholder names: `{{user_access_token}}`
- Include `Content-Type` header for POST/PUT/PATCH
- Test commands in terminal first
- Use HTTPS for all production APIs
- Set appropriate timeouts

### DON'T ❌

- Hardcode secrets in commands
- Disable SSL in production
- Use complex shell features (pipes, redirects)
- Set excessively long timeouts
- Retry non-idempotent requests

---

## Programmatic Usage

```typescript
import { CurlDefaultHandshakeExecutor } from './1.3.1.a_fileCurlDefaultHandshakeExecutor';

// Create executor
const executor = new CurlDefaultHandshakeExecutor({
  timeout: 30000,
  maxRetries: 3,
});

// Configure credentials
const credentials = {
  curlCommand: `curl -X GET 'https://api.example.com/data' \
    -H 'Authorization: Bearer {{token}}'`,
  placeholderValues: {
    token: 'your-access-token',
  },
};

// Authenticate (validates configuration)
const authResult = await executor.authenticate(credentials);
if (authResult.type === 'error') {
  console.error(authResult.error);
  return;
}

// Execute request
const result = await executor.executeRequest({
  handshakeId: 'hs_123',
  platformId: 'plat_456',
  resourceId: 'res_789',
  credentials,
  url: '', // URL comes from cURL command
  method: 'GET',
  headers: {},
});

if (result.success) {
  console.log('Response:', result.body);
} else {
  console.error('Error:', result.error);
}
```

---

## Troubleshooting

### "Parse Error: Invalid cURL command"

**Cause:** The cURL command syntax is invalid.

**Solutions:**
1. Test the command in your terminal first
2. Check for unbalanced quotes
3. Ensure backslash line continuations are correct
4. Remove unsupported options

### "Timeout exceeded"

**Cause:** The API server is slow or unreachable.

**Solutions:**
1. Increase the timeout value
2. Check your network connection
3. Verify the API endpoint is correct
4. Check if the API has rate limits

### "SSL certificate error"

**Cause:** Invalid or expired SSL certificate.

**Solutions:**
1. Check the API's SSL certificate status
2. Ensure your system clock is accurate
3. For development only: set `validateSsl: false`

### "Missing placeholder: {{xyz}}"

**Cause:** A placeholder in the command has no value.

**Solutions:**
1. Add the missing value to `placeholderValues`
2. Check for typos in placeholder names
3. Remember placeholders are case-sensitive

---

## Files in This Module

| File | Purpose |
|------|---------|
| `1.3.1.a_fileCurlDefaultHandshakeExecutor.ts` | Core execution engine |
| `1.3.1.b_fileCurlDefaultCredentialFormFields.tsx` | React UI component |
| `1.3.1.c_fileCurlDefaultWhitepaperDocumentation.ts` | Technical specification |
| `1.3.1.1.a_fileCurlDefaultProtocolReadme.md` | This documentation |

---

## Related Resources

- [Protocol Module Interface](../1.3.b_fileProtocolHandshakeModuleInterface.ts) - Base interface
- [cURL Parser Utility](../../1.4_folderSharedUtilities/1.4.a_fileCurlCommandParser.ts) - Parser implementation
- [Placeholder Substitution](../../1.4_folderSharedUtilities/1.4.e_fileInputPlaceholderSubstitution.ts) - Template engine

---

## Version History

| Version | Date | Changes |
|---------|------|---------|
| 1.0.0 | 2024-12-03 | Initial release |

---

*Protocol OS - Configure once, connect anywhere.*
